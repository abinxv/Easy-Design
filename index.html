<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>easydesign — AI Image Editor</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Bebas+Neue&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --bg: #0a0a0a;
    --surface: #141414;
    --border: #222;
    --accent: #e8ff47;
    --text: #f0f0f0;
    --muted: #555;
    --radius: 4px;
  }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 40px;
    border-bottom: 1px solid var(--border);
    background: rgba(10,10,10,0.95);
    backdrop-filter: blur(12px);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 28px;
    letter-spacing: 3px;
    color: var(--accent);
  }
  .api-badge {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 1px;
  }
  main {
    flex: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 32px;
    max-width: 1400px;
    margin: 0 auto;
    width: 100%;
    padding: 40px;
  }
  .panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  .panel-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .panel-label {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
  }
  .panel-num {
    width: 22px;
    height: 22px;
    background: var(--accent);
    color: #000;
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 2px;
  }
  .upload-zone {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    padding: 40px;
    position: relative;
    min-height: 420px;
    transition: background 0.2s;
  }
  .upload-zone.has-image { padding: 0; cursor: default; }
  .upload-zone.drag-over { background: rgba(232,255,71,0.05); }
  .upload-icon {
    width: 56px;
    height: 56px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
  }
  .upload-text {
    font-size: 14px;
    color: var(--muted);
    text-align: center;
    line-height: 1.6;
  }
  .upload-text strong { color: var(--text); font-weight: 500; }
  .upload-hint {
    margin-top: 8px;
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 1px;
  }
  #preview-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: none;
    max-height: 500px;
    padding: 16px;
  }
  input[type=file] { display: none; }
  .output-zone {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 420px;
    position: relative;
    overflow: hidden;
  }
  .output-placeholder { text-align: center; }
  .output-placeholder svg { opacity: 0.12; margin-bottom: 12px; }
  .output-placeholder p {
    font-size: 12px;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    letter-spacing: 1px;
  }
  #output-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: none;
    max-height: 500px;
    padding: 16px;
    animation: fadeIn 0.4s ease;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.97); }
    to { opacity: 1; transform: scale(1); }
  }
  .controls {
    padding: 0 40px 40px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    max-width: 1400px;
    margin: 0 auto;
    width: 100%;
  }
  .input-wrap { position: relative; flex: 1; }
  .input-label {
    font-family: 'DM Mono', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    position: absolute;
    top: 10px;
    left: 14px;
    pointer-events: none;
    z-index: 1;
  }
  textarea {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    padding: 30px 14px 12px;
    border-radius: var(--radius);
    outline: none;
    transition: border-color 0.2s;
    resize: none;
    min-height: 80px;
  }
  textarea:focus { border-color: var(--accent); }
  .prompt-row {
    display: flex;
    gap: 12px;
    align-items: flex-end;
  }
  button {
    font-family: 'Bebas Neue', sans-serif;
    letter-spacing: 2px;
    font-size: 16px;
    padding: 0 32px;
    height: 56px;
    border: none;
    border-radius: var(--radius);
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .btn-primary {
    background: var(--accent);
    color: #000;
  }
  .btn-primary:hover:not(:disabled) {
    background: #fff;
    transform: translateY(-1px);
    box-shadow: 0 8px 24px rgba(232,255,71,0.2);
  }
  .btn-primary:disabled { opacity: 0.3; cursor: not-allowed; }
  .btn-clear {
    background: transparent;
    color: var(--text);
    border: 1px solid var(--border);
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    letter-spacing: 1px;
    padding: 0 14px;
    height: 30px;
    margin-left: auto;
  }
  .btn-clear:hover { border-color: var(--text); }
  .status-bar {
    padding: 10px 40px;
    display: flex;
    align-items: center;
    gap: 10px;
    border-top: 1px solid var(--border);
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--muted);
  }
  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--muted);
    flex-shrink: 0;
    transition: background 0.3s;
  }
  .status-dot.loading { background: var(--accent); animation: pulse 1s infinite; }
  .status-dot.success { background: #4ade80; }
  .status-dot.error { background: #f87171; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
  .loading-overlay {
    position: absolute;
    inset: 0;
    background: rgba(10,10,10,0.85);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 16px;
    backdrop-filter: blur(4px);
  }
  .loading-overlay.active { display: flex; }
  .loader {
    width: 40px;
    height: 40px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    letter-spacing: 2px;
    color: var(--muted);
    text-transform: uppercase;
  }
  .download-btn {
    position: absolute;
    bottom: 16px;
    right: 16px;
    background: rgba(10,10,10,0.85);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    letter-spacing: 1px;
    padding: 8px 14px;
    border-radius: var(--radius);
    cursor: pointer;
    display: none;
    transition: all 0.2s;
    height: auto;
  }
  .download-btn:hover { border-color: var(--accent); color: var(--accent); }
  @media (max-width: 768px) {
    main { grid-template-columns: 1fr; padding: 20px; }
    header { padding: 16px 20px; }
    .controls { padding: 0 20px 32px; }
    .prompt-row { flex-direction: column; }
    .btn-primary { width: 100%; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">easydesign</div>
  <div class="api-badge">POWERED BY OPENAI</div>
</header>

<main>
  <div class="panel">
    <div class="panel-header">
      <div class="panel-num">01</div>
      <div class="panel-label">Original Image</div>
      <button class="btn-clear" onclick="clearImage()">Clear</button>
    </div>
    <div class="upload-zone" id="upload-zone"
      onclick="triggerUpload()"
      ondragover="handleDragOver(event)"
      ondragleave="handleDragLeave(event)"
      ondrop="handleDrop(event)">
      <div class="upload-icon" id="upload-icon">
        <svg width="24" height="24" fill="none" stroke="#888" stroke-width="1.5" viewBox="0 0 24 24">
          <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
        </svg>
      </div>
      <div class="upload-text" id="upload-text">
        <strong>Drop image here</strong><br>or click to browse
      </div>
      <div class="upload-hint" id="upload-hint">PNG · JPG · WEBP</div>
      <img id="preview-img" alt="Preview">
    </div>
    <input type="file" id="file-input" accept="image/png,image/jpeg,image/webp" onchange="handleFileChange(event)">
  </div>

  <div class="panel">
    <div class="panel-header">
      <div class="panel-num" style="background:#ff6b35">02</div>
      <div class="panel-label">Edited Result</div>
    </div>
    <div class="output-zone">
      <div class="output-placeholder" id="output-placeholder">
        <svg width="48" height="48" fill="none" stroke="#888" stroke-width="1" viewBox="0 0 24 24">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <circle cx="8.5" cy="8.5" r="1.5"/>
          <path d="M21 15l-5-5L5 21"/>
        </svg>
        <p>Output will appear here</p>
      </div>
      <img id="output-img" alt="Output">
      <div class="loading-overlay" id="loading-overlay">
        <div class="loader"></div>
        <div class="loading-text">Editing with OpenAI...</div>
      </div>
      <button class="download-btn" id="download-btn" onclick="downloadOutput()">&#8595; DOWNLOAD</button>
    </div>
  </div>
</main>

<div class="controls">
  <div class="prompt-row">
    <div class="input-wrap">
      <div class="input-label">Edit Instruction</div>
      <textarea id="prompt" placeholder="e.g. Make the sky purple, add dramatic storm clouds... (Ctrl+Enter to generate)"></textarea>
    </div>
    <button class="btn-primary" id="generate-btn" onclick="generateEdit()" disabled>GENERATE</button>
  </div>
</div>

<div class="status-bar">
  <div class="status-dot" id="status-dot"></div>
  <span id="status-text">Ready — upload an image to begin</span>
</div>

<script>
  const API_KEY = ''//gotta fix this somehow

  let uploadedFile = null;

  function triggerUpload() {
    if (!uploadedFile) document.getElementById('file-input').click();
  }

  function handleDragOver(e) {
    e.preventDefault();
    document.getElementById('upload-zone').classList.add('drag-over');
  }

  function handleDragLeave() {
    document.getElementById('upload-zone').classList.remove('drag-over');
  }

  function handleDrop(e) {
    e.preventDefault();
    document.getElementById('upload-zone').classList.remove('drag-over');
    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith('image/')) loadFile(file);
  }

  function handleFileChange(e) {
    const file = e.target.files[0];
    if (file) loadFile(file);
  }

  function loadFile(file) {
    uploadedFile = file;
    const reader = new FileReader();
    reader.onload = (e) => {
      const preview = document.getElementById('preview-img');
      preview.src = e.target.result;
      preview.style.display = 'block';

      document.getElementById('upload-zone').classList.add('has-image');
      document.getElementById('upload-icon').style.display = 'none';
      document.getElementById('upload-text').style.display = 'none';
      document.getElementById('upload-hint').style.display = 'none';

      checkReady();
      setStatus('success', 'Image loaded — ' + file.name + ' (' + (file.size / 1024).toFixed(0) + ' KB)');
    };
    reader.readAsDataURL(file);
  }

  function clearImage() {
    uploadedFile = null;
    const preview = document.getElementById('preview-img');
    preview.src = '';
    preview.style.display = 'none';

    document.getElementById('upload-zone').classList.remove('has-image');
    document.getElementById('upload-icon').style.display = 'flex';
    document.getElementById('upload-text').style.display = 'block';
    document.getElementById('upload-hint').style.display = 'block';
    document.getElementById('file-input').value = '';

    checkReady();
    setStatus('idle', 'Ready — upload an image to begin');
  }

  function checkReady() {
    document.getElementById('generate-btn').disabled = !uploadedFile;
  }

  function setStatus(state, msg) {
    document.getElementById('status-dot').className = 'status-dot ' + (state === 'idle' ? '' : state);
    document.getElementById('status-text').textContent = msg;
  }

  async function generateEdit() {
    const prompt = document.getElementById('prompt').value.trim();
    if (!prompt) { setStatus('error', 'Please enter an edit instruction'); return; }
    if (!uploadedFile) { setStatus('error', 'Please upload an image first'); return; }

    setStatus('loading', 'Sending to OpenAI...');
    document.getElementById('loading-overlay').classList.add('active');
    document.getElementById('generate-btn').disabled = true;

    try {
      // Convert image to PNG if needed (OpenAI requires PNG for edits)
      const pngFile = await convertToPng(uploadedFile);

      const formData = new FormData();
      formData.append('model', 'gpt-image-1');
      formData.append('image[]', pngFile, 'image.png');
      formData.append('prompt', prompt);
      formData.append('n', '1');
      formData.append('size', '1024x1024');

      const response = await fetch('https://api.openai.com/v1/images/edits', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + API_KEY
        },
        body: formData
      });

      const data = await response.json();
      console.log('OpenAI response:', JSON.stringify(data, null, 2));

      if (!response.ok) {
        throw new Error(data?.error?.message || 'HTTP ' + response.status);
      }

      const imageData = data?.data?.[0];
      if (!imageData) throw new Error('No image in response. Check console for details.');

      let imgSrc;
      if (imageData.b64_json) {
        imgSrc = 'data:image/png;base64,' + imageData.b64_json;
      } else if (imageData.url) {
        imgSrc = imageData.url;
      } else {
        throw new Error('Unexpected response format from OpenAI.');
      }

      const outputImg = document.getElementById('output-img');
      outputImg.src = imgSrc;
      outputImg.style.display = 'block';
      document.getElementById('output-placeholder').style.display = 'none';
      document.getElementById('download-btn').style.display = 'block';

      setStatus('success', 'Edit complete!');

    } catch (err) {
      console.error('Error:', err);
      setStatus('error', err.message);
    } finally {
      document.getElementById('loading-overlay').classList.remove('active');
      document.getElementById('generate-btn').disabled = false;
    }
  }

  // Convert any image to PNG Blob using canvas
  function convertToPng(file) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      const url = URL.createObjectURL(file);
      img.onload = () => {
        const canvas = document.createElement('canvas');
        canvas.width = img.naturalWidth;
        canvas.height = img.naturalHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        URL.revokeObjectURL(url);
        canvas.toBlob((blob) => {
          if (blob) resolve(new File([blob], 'image.png', { type: 'image/png' }));
          else reject(new Error('Failed to convert image to PNG'));
        }, 'image/png');
      };
      img.onerror = () => reject(new Error('Failed to load image'));
      img.src = url;
    });
  }

  function downloadOutput() {
    const img = document.getElementById('output-img');
    if (!img.src) return;
    const a = document.createElement('a');
    a.href = img.src;
    a.download = 'easydesign-' + Date.now() + '.png';
    a.click();
  }

  document.getElementById('prompt').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) generateEdit();
  });
</script>

</body>
</html>